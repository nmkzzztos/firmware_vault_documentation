"use strict";(self.webpackChunkfirmware_vault_docs=self.webpackChunkfirmware_vault_docs||[]).push([[5573],{3951:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"Backend/wrapperdoku","title":"Wrapper Documentation","description":"The wrappers for the analysis tools are currently stored in the `/jobs/`","source":"@site/docs/Backend/wrapperdoku.md","sourceDirName":"Backend","slug":"/Backend/wrapperdoku","permalink":"/firmware_vault_documentation/docs/Backend/wrapperdoku","draft":false,"unlisted":false,"editUrl":"https://github.com/nmkzzztos/firmware_vault_documentation/tree/main/docs/Backend/wrapperdoku.md","tags":[],"version":"current","frontMatter":{},"sidebar":"gettingStartedSidebar","previous":{"title":"Analysis Engine","permalink":"/firmware_vault_documentation/docs/Backend/introduction"},"next":{"title":"Docusaurus","permalink":"/firmware_vault_documentation/docs/Documentation/docusaurus"}}');var i=t(4848),a=t(8453);const s={},o="Wrapper Documentation",l={},c=[{value:"cve-bin-tool.py",id:"cve-bin-toolpy",level:2},{value:"binwalk",id:"binwalk",level:2},{value:"Firmwalker",id:"firmwalker",level:2},{value:"Requirements for writing your own analysis wrapper",id:"requirements-for-writing-your-own-analysis-wrapper",level:2},{value:"1. Writing the client-sided script to interact with the Wrapper",id:"1-writing-the-client-sided-script-to-interact-with-the-wrapper",level:3},{value:"2. Writing the wrapper itself",id:"2-writing-the-wrapper-itself",level:3}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"wrapper-documentation",children:"Wrapper Documentation"})}),"\n",(0,i.jsxs)(n.p,{children:["The wrappers for the analysis tools are currently stored in the ",(0,i.jsx)(n.code,{children:"/jobs/"}),"\ndirectory of the Project"]}),"\n",(0,i.jsx)(n.h2,{id:"cve-bin-toolpy",children:"cve-bin-tool.py"}),"\n",(0,i.jsxs)(n.p,{children:["The cve-bin-tool.py is an example implementation of a wrapper for an analysis\ntool. In this case Intel's ",(0,i.jsx)(n.a,{href:"https://github.com/intel/cve-bin-tool",children:"cve-bin-tool"}),"\nwas used. The analysis binary gets called with the path to analyze and the\noutput gets written to a ",(0,i.jsx)(n.code,{children:"json"})," file. Before the data of the output file\ngets inserted, it is checked whether the data already exists in the database\nor not, so the results are not inserted twice."]}),"\n",(0,i.jsx)(n.h2,{id:"binwalk",children:"binwalk"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"binwalk3.py"})," automates the process of running Binwalk on a given firmware\nimage, extracting relevant information, and storing the results in a\ndatabase.\nIt runs with the ",(0,i.jsx)(n.code,{children:"-Me"})," flags, which are required for deeper analysis"]}),"\n",(0,i.jsx)(n.h2,{id:"firmwalker",children:"Firmwalker"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"firmwalker_service.py"})," is a wrapper around the ",(0,i.jsx)(n.a,{href:"https://github.com/craigz28/firmwalker",children:"firmwalker.sh"})," open-source bash script, which automates finding file that could be of interest for further analysis, such as ",(0,i.jsx)(n.strong,{children:"/etc/shadow"})," or .cfg files."]}),"\n",(0,i.jsx)(n.h2,{id:"requirements-for-writing-your-own-analysis-wrapper",children:"Requirements for writing your own analysis wrapper"}),"\n",(0,i.jsx)(n.p,{children:"Generally, you can decide yourself how the command with which your wrapper is called looks. You will probably want to define some parameters like filepath, image ID, and potentially the directory for logs (if your tool creates any). When defining a bulk job, the user can then enter the placeholder strings for the parameters, which will be replaced with the actual values during execution."}),"\n",(0,i.jsx)(n.p,{children:"The following parameter placeholders are currently available (all are optional):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"<image_path>"}),": The path to the image file that should be analyzed."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"<image_id>"}),": The ID by which the image can be identified in the database."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"<logging_path>"}),": If you create permanent files, like logs, your wrapper should place them in this directory."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"So, if a user creates a job in the UI with this command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"python my_scrapper <image_path> <image_id> <logging_path>\n"})}),"\n",(0,i.jsx)(n.p,{children:"a command that is actually executed could look like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"python my_scrapper /path/to/the/image.bin 123 /dir/where/you/can/place/logs\n"})}),"\n",(0,i.jsxs)(n.p,{children:["In your program, you can then call the analysis tool you're wrapping with the image file path. You'll have to write some code that parses the output of the tool and inserts it into the database. For that, you need to create a new table in the database that should include the ",(0,i.jsx)(n.code,{children:"image_id"})," you get in the arguments and the results. All database interaction is currently handled by ",(0,i.jsx)(n.code,{children:"DBConnector.py"}),". You will have to add the necessary insert functions into it."]}),"\n",(0,i.jsx)(n.h3,{id:"1-writing-the-client-sided-script-to-interact-with-the-wrapper",children:"1. Writing the client-sided script to interact with the Wrapper"}),"\n",(0,i.jsxs)(n.p,{children:["The following template cann be used to make the script, make sure to change the ",(0,i.jsx)(n.code,{children:"name of service"})," and ",(0,i.jsx)(n.code,{children:"port"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import requests\nimport sys\n\ndef run_firmwalker(image_id: str, path: str, output_path: str):\n    """Send a request to the Firmwalker service."""\n    url = "http://<name of service>:<port>/post"\n    payload = {\n        "image_id": image_id,\n        "path": path,\n        "output_path": output_path,\n    }\n\n    try:\n        response = requests.post(url, json=payload)\n\n        if response.status_code == 200:\n            print(f"Successful response: {response.json()}")\n        else:\n            print(f"Error during processing: {response.text}")\n    except Exception as e:\n        print(f"Error sending request: {e}")\n\ndef main(image_id: str, path: str, output_path: str):\n    run_firmwalker(image_id, path, output_path)\n\nif __name__ == "__main__":\n    image_id: str = sys.argv[1]\n    path: str = sys.argv[2]\n    output_path: str = sys.argv[3]\n    main(image_id, path, output_path)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"2-writing-the-wrapper-itself",children:"2. Writing the wrapper itself"}),"\n",(0,i.jsxs)(n.p,{children:["The Flask API here will handle requests from the client script and invoke the desired services or components to process the data.\nPlease look at the file ",(0,i.jsx)(n.code,{children:"firmwalker_service.py"})," while reading this part so it makes sense."]}),"\n",(0,i.jsx)(n.p,{children:"First make the necessary imports:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from flask import Flask, request, jsonify\nfrom multiprocessing import Pool, freeze_support, set_start_method, get_start_method\nimport os\nimport subprocess\nimport logging\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Instantiate the Flask App with:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"app = Flask(__name__)\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Keep the logging part and change the name of the logfile to match the name of your service:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'logging.basicConfig(\n    filename="<Name of Service>.log",\n    level=logging.INFO,\n    format="%(asctime)s - %(levelname)s - %(message)s"\n)\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Implement the ",(0,i.jsx)(n.code,{children:"run_<service name>()"}),"method which contains the main functionality of your Wrapper."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Keep the ",(0,i.jsx)(n.code,{children:"handle_<service name>_task(image_id: str, path: str, output_path: str) -> dict"})," method as is, don't forget to change the name of ",(0,i.jsx)(n.code,{children:"run_<service name>"})," when calling it."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Keep the ",(0,i.jsx)(n.code,{children:'@app.route("/post", methods=["POST"]) def handle_request()'})," method. Don't forget to make the necessary changes to the called functions as mentioned above."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Keep the ",(0,i.jsx)(n.code,{children:'if __name__ == "__main__":'}),"part, and don't forget to change the ",(0,i.jsx)(n.strong,{children:"port"})," in the ",(0,i.jsx)(n.code,{children:"app.run()"})," method call."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Finally, you need to edit the ",(0,i.jsx)(n.code,{children:"Dockerfile_executor"}),". Copy your newly created ",(0,i.jsx)(n.strong,{children:"client-side script"})," into the working directory. Also, don't forget to add any necessary commands to install/load the analysis tool you are wrapping."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Note:"})}),"\n",(0,i.jsxs)(n.p,{children:["The previous example was based on ",(0,i.jsx)(n.code,{children:"firmwalker_service.py"}),", which doesn't save the output to the database, if that functionality is needed, please refer to ",(0,i.jsx)(n.code,{children:"binwalk3.py"}),"."]})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var r=t(6540);const i={},a=r.createContext(i);function s(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);