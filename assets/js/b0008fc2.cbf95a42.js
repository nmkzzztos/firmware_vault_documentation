"use strict";(self.webpackChunkfirmware_vault_docs=self.webpackChunkfirmware_vault_docs||[]).push([[3460],{394:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"Backend/wrapper-documentation","title":"Write Your Own Wrapper","description":"The wrappers for the analysis tools are currently stored in the `/jobs/`","source":"@site/docs/Backend/wrapper-documentation.md","sourceDirName":"Backend","slug":"/Backend/wrapper-documentation","permalink":"/firmware_vault_documentation/docs/Backend/wrapper-documentation","draft":false,"unlisted":false,"editUrl":"https://github.com/nmkzzztos/firmware_vault_documentation/tree/main/docs/Backend/wrapper-documentation.md","tags":[],"version":"current","frontMatter":{"id":"wrapper-documentation","title":"Write Your Own Wrapper"},"sidebar":"gettingStartedSidebar","previous":{"title":"The Implemented Modules","permalink":"/firmware_vault_documentation/docs/Backend/implemented-modules"},"next":{"title":"Firmwalker","permalink":"/firmware_vault_documentation/docs/Backend/firmwalker"}}');var i=n(4848),a=n(8453);const s={id:"wrapper-documentation",title:"Write Your Own Wrapper"},o="Wrapper Documentation",l={},c=[{value:"Requirements for writing your own analysis wrapper",id:"requirements-for-writing-your-own-analysis-wrapper",level:2},{value:"1. Writing the client-sided script to interact with the Wrapper",id:"1-writing-the-client-sided-script-to-interact-with-the-wrapper",level:3},{value:"2. Writing the wrapper itself",id:"2-writing-the-wrapper-itself",level:3}];function d(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"wrapper-documentation",children:"Wrapper Documentation"})}),"\n",(0,i.jsxs)(t.p,{children:["The wrappers for the analysis tools are currently stored in the ",(0,i.jsx)(t.code,{children:"/jobs/"}),"\ndirectory of the Project"]}),"\n",(0,i.jsx)(t.h2,{id:"requirements-for-writing-your-own-analysis-wrapper",children:"Requirements for writing your own analysis wrapper"}),"\n",(0,i.jsx)(t.p,{children:"Generally, you can decide yourself how the command with which your wrapper is called looks. You will probably want to define some parameters like filepath, image ID, and potentially the directory for logs (if your tool creates any). When defining a bulk job, the user can then enter the placeholder strings for the parameters, which will be replaced with the actual values during execution."}),"\n",(0,i.jsx)(t.p,{children:"The following parameter placeholders are currently available (all are optional):"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"<image_path>"}),": The path to the image file that should be analyzed."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"<image_id>"}),": The ID by which the image can be identified in the database."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"<logging_path>"}),": If you create permanent files, like logs, your wrapper should place them in this directory."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"So, if a user creates a job in the UI with this command:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:"python my_scrapper <image_path> <image_id> <logging_path>\n"})}),"\n",(0,i.jsx)(t.p,{children:"a command that is actually executed could look like this:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:"python my_scrapper /path/to/the/image.bin 123 /dir/where/you/can/place/logs\n"})}),"\n",(0,i.jsxs)(t.p,{children:["In your program, you can then call the analysis tool you're wrapping with the image file path. You'll have to write some code that parses the output of the tool and inserts it into the database. For that, you need to create a new table in the database that should include the ",(0,i.jsx)(t.code,{children:"image_id"})," you get in the arguments and the results. All database interaction is currently handled by ",(0,i.jsx)(t.code,{children:"DBConnector.py"}),". You will have to add the necessary insert functions into it."]}),"\n",(0,i.jsx)(t.h3,{id:"1-writing-the-client-sided-script-to-interact-with-the-wrapper",children:"1. Writing the client-sided script to interact with the Wrapper"}),"\n",(0,i.jsxs)(t.p,{children:["The following template cann be used to make the script, make sure to change the ",(0,i.jsx)(t.code,{children:"name of service"})," and ",(0,i.jsx)(t.code,{children:"port"})]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'import requests\nimport sys\n\ndef run_firmwalker(image_id: str, path: str, output_path: str):\n    """Send a request to the Firmwalker service."""\n    url = "http://<name of service>:<port>/post"\n    payload = {\n        "image_id": image_id,\n        "path": path,\n        "output_path": output_path,\n    }\n\n    try:\n        response = requests.post(url, json=payload)\n\n        if response.status_code == 200:\n            print(f"Successful response: {response.json()}")\n        else:\n            print(f"Error during processing: {response.text}")\n    except Exception as e:\n        print(f"Error sending request: {e}")\n\ndef main(image_id: str, path: str, output_path: str):\n    run_firmwalker(image_id, path, output_path)\n\nif __name__ == "__main__":\n    image_id: str = sys.argv[1]\n    path: str = sys.argv[2]\n    output_path: str = sys.argv[3]\n    main(image_id, path, output_path)\n'})}),"\n",(0,i.jsx)(t.h3,{id:"2-writing-the-wrapper-itself",children:"2. Writing the wrapper itself"}),"\n",(0,i.jsxs)(t.p,{children:["The Flask API here will handle requests from the client script and invoke the desired services or components to process the data.\nPlease look at the file ",(0,i.jsx)(t.code,{children:"firmwalker_service.py"})," while reading this part so it makes sense."]}),"\n",(0,i.jsx)(t.p,{children:"First make the necessary imports:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:"from flask import Flask, request, jsonify\nfrom multiprocessing import Pool, freeze_support, set_start_method, get_start_method\nimport os\nimport subprocess\nimport logging\n"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Instantiate the Flask App with:"}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:"app = Flask(__name__)\n"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Keep the logging part and change the name of the logfile to match the name of your service:"}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'logging.basicConfig(\n    filename="<Name of Service>.log",\n    level=logging.INFO,\n    format="%(asctime)s - %(levelname)s - %(message)s"\n)\n'})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Implement the ",(0,i.jsx)(t.code,{children:"run_<service name>()"}),"method which contains the main functionality of your Wrapper."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Keep the ",(0,i.jsx)(t.code,{children:"handle_<service name>_task(image_id: str, path: str, output_path: str) -> dict"})," method as is, don't forget to change the name of ",(0,i.jsx)(t.code,{children:"run_<service name>"})," when calling it."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Keep the ",(0,i.jsx)(t.code,{children:'@app.route("/post", methods=["POST"]) def handle_request()'})," method. Don't forget to make the necessary changes to the called functions as mentioned above."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Keep the ",(0,i.jsx)(t.code,{children:'if __name__ == "__main__":'}),"part, and don't forget to change the ",(0,i.jsx)(t.strong,{children:"port"})," in the ",(0,i.jsx)(t.code,{children:"app.run()"})," method call."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Finally, you need to edit the ",(0,i.jsx)(t.code,{children:"Dockerfile_executor"}),". Copy your newly created ",(0,i.jsx)(t.strong,{children:"client-side script"})," into the working directory. Also, don't forget to add any necessary commands to install/load the analysis tool you are wrapping."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Notes:"})}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["The previous example was based on ",(0,i.jsx)(t.code,{children:"firmwalker_service.py"}),", which doesn't save the output to the database, if that functionality is needed, please refer to ",(0,i.jsx)(t.code,{children:"binwalk3.py"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:["After finishing a module, it must be added to the project's Docker setup, a detailed tutorial is available in the ",(0,i.jsx)(t.code,{children:"Firmwalker"})," tab on the sidebar, where the module Firmwalker is taken as an example."]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>o});var r=n(6540);const i={},a=r.createContext(i);function s(e){const t=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(a.Provider,{value:t},e.children)}}}]);